name: DevOps Manual Approval Pipeline for Exchange API RAMLs

on:
  workflow_dispatch:

jobs:
  notify-for-approval:
    name: Send Approval Email
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Send email requesting approval
        uses: dawidd6/action-send-mail@v3
        with:
          server_address: smtp.gmail.com
          server_port: 587
          username: ${{ secrets.SMTP_USERNAME }}
          password: ${{ secrets.SMTP_PASSWORD }}
          subject: "Manual approval required for deployment"
          to: "rajat.guptadhn@gmil.com"
          from: "rk173346@gmail.com"
          body: "An Exchange API RAML has been checked in to the repository and requires validation from your end and final approval to proceed to actual BG publication. Please review and approve it."

  wait-for-approval:
    name: Pending for Manual Approval
    runs-on: ubuntu-latest
    needs: notify-for-approval

    # This environment must be configured in the repo settings with required reviewers.
    environment: 
      name: development
      url: https://example.com

    steps:
      - name: Continue after approval
        run: echo "Approval received. Continuing workflow..."
